// Example: Missing EventMeta (must-fix)
//
// This event contract is missing the EventMeta message and the
// corresponding `meta` field on the change event. Without event
// metadata, consumers cannot deduplicate (no event_id), track
// provenance (no producer), or order by event time.
//
// Expected findings:
//   - Must-fix: No EventMeta message defined
//   - Must-fix: No `meta` field on PaymentChangeEvent
//
// Standard sections exercised:
//   - Canonical change event pattern / Required fields
//     ("All entity change events MUST include: meta (event metadata)")

syntax = "proto3";

package example.payments.v1;

import "buf/validate/validate.proto";
import "google/protobuf/field_mask.proto";

enum Operation {
  OPERATION_UNSPECIFIED = 0;
  OPERATION_CREATE     = 1;
  OPERATION_UPDATE     = 2;
  OPERATION_DELETE     = 3;
  OPERATION_SNAPSHOT   = 4;
}

message Payment {
  string payment_id = 1 [(buf.validate.field).string.min_len = 1];
  string order_id = 2 [(buf.validate.field).string.min_len = 1];
  int64 amount_cents = 3 [(buf.validate.field).int64.gte = 0];
  string currency = 4 [(buf.validate.field).string.min_len = 1];
}

// Missing: no `meta` field â€” cannot deduplicate, track provenance, or
// order events.
message PaymentChangeEvent {
  string payment_id = 1 [(buf.validate.field).string.min_len = 1];

  int64 sequence = 2 [(buf.validate.field).int64.gte = 0];
  Operation op = 3 [(buf.validate.field).enum.defined_only = true];

  google.protobuf.FieldMask update_mask = 4;
  Payment patch = 5;
  Payment after = 6;
}
